<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex,nofollow">
<title>GMã‚·ãƒ¼ãƒ«æŠ½é¸ä¼š</title>

<style>
body {
  background: #fff8e7;
  text-align: center;
  font-family: "Hiragino Maru Gothic ProN", sans-serif;
}

h1 {
  color: #ff6b6b;
  margin-top: 20px;
}

#slot {
  margin: 30px auto;
  width: 260px;
  height: 260px;
  border: 10px solid #ffcc66;
  border-radius: 30px;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
}

#slot img {
  width: 220px;
  height: 220px;
}

button {
  font-size: 24px;
  padding: 15px 40px;
  border-radius: 20px;
  border: none;
  background: #4caf50;
  color: white;
}

button:disabled {
  background: #aaa;
}

#result {
  margin-top: 25px;
  font-size: 22px;
}
</style>
</head>

<body>

<h1>GMã‚·ãƒ¼ãƒ«æŠ½é¸ä¼š</h1>

<div id="slot">
  <img id="slotImage"
       src="https://raw.githubusercontent.com/work-sakumi/gm-slot/main/gm-slot/images/stickers01.png"
       alt="slot image">
</div>

<button id="enableBtn">ğŸ”Š éŸ³ã‚’å‡ºã—ã¦ã¯ã˜ã‚ã‚‹</button>
<br><br>
<button id="startBtn" disabled>ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

<div id="result"></div>

<script>
/* ====== ãƒ™ãƒ¼ã‚¹URLï¼ˆraw GitHubï¼‰ ====== */
const baseRaw = 'https://raw.githubusercontent.com/work-sakumi/gm-slot/main/gm-slot';

/* ====== ã‚·ãƒ¼ãƒ«ç”»åƒ ====== */
const stickers = [];
for (let i = 1; i <= 40; i++) {
  stickers.push(`${baseRaw}/images/stickers${String(i).padStart(2,"0")}.png`);
}

/* ãƒ—ãƒ¬ãƒ­ãƒ¼ãƒ‰ï¼ˆä»»æ„ã ãŒå®‰å®šæ€§UPï¼‰ */
stickers.forEach(src => {
  const img = new Image();
  img.src = src;
});

/* ====== åŠ¹æœéŸ³ ====== */
const startSound   = new Audio(`${baseRaw}/sounds/start.mp3`);
const spinSound    = new Audio(`${baseRaw}/sounds/spin.mp3`);
const fanfareSound = new Audio(`${baseRaw}/sounds/fanfare.mp3`);
spinSound.loop = true;

/* ====== ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ====== */
const narrationStartText = `
ï¼‘å¹´é–“ã€GMãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’é ‘å¼µã‚Šã¾ã—ãŸã­ã€‚
ã“ã‚Œã‹ã‚‰ã€GMã‚·ãƒ¼ãƒ«æŠ½é¸ä¼šã‚’å§‹ã‚ã¾ã™ã€‚
ã‚¹ãƒ­ãƒƒãƒˆãŒå›ã‚Šã€æ­¢ã¾ã£ãŸã‚·ãƒ¼ãƒ«ãŒã€
ã‚ãªãŸã®ã‚¯ãƒ©ã‚¹ã®ã€ã‚ãŸã‚Šã‚·ãƒ¼ãƒ«ã§ã™ã€‚
ãã‚Œã§ã¯ã€ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã™ã€‚
`;

const narrationEndText = `
ã¿ãªã•ã‚“ã€è‡ªåˆ†ã®GMã‚«ãƒ¼ãƒ‰ã«ã€
ã‚ãŸã‚Šã‚·ãƒ¼ãƒ«ã¯ã‚ã‚Šã¾ã—ãŸã‹ã€‚
ç¢ºèªã—ã¦ãã ã•ã„ã€‚

ã‚ãŸã‚Šã‚·ãƒ¼ãƒ«ãŒã‚ã£ãŸäººã¯ã€
ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚
æ¥æœˆã€æ™¯å“ã‚’ãŠæ¸¡ã—ã—ã¾ã™ã€‚

ã‚·ãƒ¼ãƒ«ãŒãªã‹ã£ãŸäººã‚‚ã€
è¦‹é€ƒã—ã¦ã„ãªã„ã‹ç¢ºèªã™ã‚‹ã®ã§ã€
å…ˆç”Ÿã«GMã‚«ãƒ¼ãƒ‰ã‚’æ¸¡ã—ã¦ãã ã•ã„ã€‚

æ¥å¹´ã‚‚ã€GMãƒãƒ£ãƒ¬ãƒ³ã‚¸ã§ã€
å…ƒæ°—ã«ç”Ÿæ´»ã—ã¾ã—ã‚‡ã†ã€‚
ã“ã‚Œã§ã€GMã‚·ãƒ¼ãƒ«æŠ½é¸ä¼šã‚’çµ‚ã‚ã‚Šã¾ã™ã€‚
`;

/* ====== éŸ³å£°èª­ã¿ä¸Šã’ ====== */
function speak(text) {
  if (!window.speechSynthesis) return;
  const uttr = new SpeechSynthesisUtterance(text);
  uttr.lang = "ja-JP";
  uttr.rate = 0.8;
  uttr.pitch = 1.0;
  speechSynthesis.speak(uttr);
}

/* ====== UI ====== */
const enableBtn = document.getElementById('enableBtn');
const startBtn  = document.getElementById('startBtn');
const slotImage = document.getElementById('slotImage');
const resultDiv = document.getElementById('result');

enableBtn.addEventListener('click', () => {
  startBtn.disabled = false;
  enableBtn.style.display = 'none';

  speak(narrationStartText);

  // éŸ³å£°ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ï¼ˆå¤±æ•—ã—ã¦ã‚‚OKï¼‰
  startSound.play().then(()=>startSound.pause()).catch(()=>{});
  spinSound.play().then(()=>spinSound.pause()).catch(()=>{});
  fanfareSound.play().then(()=>fanfareSound.pause()).catch(()=>{});
});

/* ====== ã‚¹ãƒ­ãƒƒãƒˆåˆ¶å¾¡ ====== */
let timer = null;

function startSlot() {
  startBtn.disabled = true;
  resultDiv.innerHTML = "";

  startSound.currentTime = 0;
  startSound.play().catch(()=>{});

  spinSound.currentTime = 0;
  spinSound.play().catch(()=>{});

  timer = setInterval(() => {
    const r = Math.floor(Math.random() * stickers.length);
    slotImage.src = stickers[r];
  }, 80);

  setTimeout(stopSlot, 3000);
}

function stopSlot() {
  clearInterval(timer);
  timer = null;

  spinSound.pause();

  fanfareSound.currentTime = 0;
  fanfareSound.play().catch(()=>{});

  const img = slotImage.src;
  resultDiv.innerHTML =
    "ã‚ãªãŸã®ã‚¯ãƒ©ã‚¹ã®ã‚ãŸã‚Šã‚·ãƒ¼ãƒ«ã¯ã€<br>" +
    `<img src="${img}" style="width:160px;margin-top:10px;">`;

  setTimeout(() => {
    speak(narrationEndText);
    startBtn.disabled = false;
  }, 1500);
}

startBtn.addEventListener('click', startSlot);
</script>

</body>
</html>
