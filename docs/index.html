<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GMã‚·ãƒ¼ãƒ«æŠ½é¸ä¼š</title>

<style>
body {
  margin: 0;
  font-family: "Rounded Mplus 1c", sans-serif;
  background: linear-gradient(#fff7fb, #ffeaf4);
  text-align: center;
}

h1 {
  font-size: 42px;
  color: #ff4f9a;
  margin: 20px 0;
}

.screen { display: none; }
.active { display: block; }

.slot {
  width: 360px;
  height: 360px;
  margin: 20px auto;
  border: 12px solid #ff9fc9;
  border-radius: 30px;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
}

#sealArea img {
  max-width: 95%;
  max-height: 95%;
}

.resultText {
  font-size: 26px;
  margin-top: 12px;
  color: #444;
  line-height: 1.5;
}

button {
  font-size: 28px;
  padding: 16px 50px;
  margin: 12px;
  border-radius: 40px;
  border: none;
  background: #ff4f9a;
  color: white;
  cursor: pointer;
}
button:disabled {
  opacity: 0.5;
}
</style>
</head>

<body>

<!-- ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢ -->
<div id="intro" class="screen active">
  <h1>ğŸ‰ GMã‚·ãƒ¼ãƒ«æŠ½é¸ä¼š ğŸ‰</h1>
  <button id="enableBtn">ğŸ”Š éŸ³ã‚’å‡ºã—ã¦ã¯ã˜ã‚ã‚‹</button><br>
  <button id="startBtn" disabled>ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<!-- ã‚¹ãƒ­ãƒƒãƒˆç”»é¢ -->
<div id="game" class="screen">
  <h1>ğŸ‰ GMã‚·ãƒ¼ãƒ«æŠ½é¸ä¼š ğŸ‰</h1>

  <div class="slot">
    <div id="sealArea">
      <img src="images/stickers01.png">
    </div>
  </div>

  <button id="spinBtn">ã‚·ãƒ¼ãƒ«ã‚’å¼•ã</button>
  <button onclick="fullscreen()">å…¨ç”»é¢</button>
</div>

<!-- åŠ¹æœéŸ³ -->
<audio id="startSound" src="sounds/start.mp3"></audio>
<audio id="spinSound" src="sounds/spin.mp3" loop></audio>
<audio id="winSound" src="sounds/fanfare.mp3"></audio>

<script>
/* ===== éŸ³å£°ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===== */
function speak(text) {
  if (!window.speechSynthesis) return;
  speechSynthesis.cancel();
  const uttr = new SpeechSynthesisUtterance(text);
  uttr.lang = "ja-JP";
  uttr.rate = 0.85;
  uttr.pitch = 1.0;
  speechSynthesis.speak(uttr);
}

/* ===== ã‚·ãƒ¼ãƒ«é…åˆ— ===== */
const seals = Array.from({ length: 40 }, (_, i) => `images/stickers${String(i+1).padStart(2,"0")}.png`);
const sealArea = document.getElementById("sealArea");

/* ===== å¤‰æ•° ===== */
let spinning = false;
let spinInterval;
let currentIndex = 0;

/* ===== UI ===== */
const enableBtn = document.getElementById("enableBtn");
const startBtn  = document.getElementById("startBtn");
const spinBtn   = document.getElementById("spinBtn");

/* éŸ³ã‚’ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ */
enableBtn.onclick = () => {
  startBtn.disabled = false;
  enableBtn.style.display = "none";

  // éŸ³ã®äº‹å‰å†ç”Ÿã§ã‚¢ãƒ³ãƒ­ãƒƒã‚¯
  startSound.play().then(()=>startSound.pause()).catch(()=>{});
  spinSound.play().then(()=>spinSound.pause()).catch(()=>{});
  winSound.play().then(()=>winSound.pause()).catch(()=>{});

  // é–‹å§‹ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  speak(`
ï¼‘å¹´é–“ã€GMãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’é ‘å¼µã‚Šã¾ã—ãŸã­ã€‚
ã“ã‚Œã‹ã‚‰ã€GMã‚·ãƒ¼ãƒ«æŠ½é¸ä¼šã‚’å§‹ã‚ã¾ã™ã€‚
ã‚¹ãƒ­ãƒƒãƒˆãŒå›ã‚Šã€æ­¢ã¾ã£ãŸã‚·ãƒ¼ãƒ«ãŒã‚ãªãŸã®ã‚¯ãƒ©ã‚¹ã®ã‚ãŸã‚Šã‚·ãƒ¼ãƒ«ã§ã™ã€‚
ãã‚Œã§ã¯ã€ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã™ã€‚
  `);
};

/* ã‚²ãƒ¼ãƒ ç”»é¢ã«åˆ‡ã‚Šæ›¿ãˆ */
startBtn.onclick = () => {
  document.getElementById("intro").classList.remove("active");
  document.getElementById("game").classList.add("active");
};

/* ã‚¹ãƒ­ãƒƒãƒˆé–‹å§‹ */
spinBtn.onclick = () => {
  if (spinning) return;
  spinning = true;
  spinBtn.disabled = true;

  startSound.currentTime = 0;
  startSound.play();

  spinSound.currentTime = 0;
  spinSound.play();

  spinInterval = setInterval(() => {
    currentIndex = Math.floor(Math.random() * seals.length);
    sealArea.innerHTML = `<img src="${seals[currentIndex]}">`;
  }, 90);

  setTimeout(stopSpin, 3000);
};

/* ã‚¹ãƒ­ãƒƒãƒˆåœæ­¢ */
function stopSpin() {
  clearInterval(spinInterval);
  spinSound.pause();

  sealArea.innerHTML = `
    <div>
      <img src="${seals[currentIndex]}" style="max-width:95%;"><br>
      <div class="resultText">
        ã‚ãªãŸã®ã‚¯ãƒ©ã‚¹ã®<br>
        ã‚ãŸã‚Šã‚·ãƒ¼ãƒ«ã¯ã€<br>
      ã€€<strong>ã“ã®ã‚·ãƒ¼ãƒ«ã§ã™ï¼</strong><br>
          ï¼ˆNo.${n + 1}ï¼‰
      </div>
    </div>
  `;

  winSound.currentTime = 0;
  winSound.play();

  setTimeout(() => {
    speak(`
ã¿ãªã•ã‚“ã€è‡ªåˆ†ã®GMã‚«ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
ã‚ãŸã‚Šã‚·ãƒ¼ãƒ«ãŒã‚ã£ãŸäººã¯ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚
æ¥å¹´ã‚‚GMãƒãƒ£ãƒ¬ãƒ³ã‚¸ã§å…ƒæ°—ã«ç”Ÿæ´»ã—ã¾ã—ã‚‡ã†ã€‚
    `);
    spinBtn.disabled = false;
    spinning = false;
  }, 1500);
}

/* å…¨ç”»é¢è¡¨ç¤º */
function fullscreen() {
  document.documentElement.requestFullscreen?.();
}
</script>

</body>
</html>
